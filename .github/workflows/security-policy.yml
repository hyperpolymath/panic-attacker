# SPDX-License-Identifier: PMPL-1.0-or-later
name: Security Policy Enforcement

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  check:
    name: Verify Security Files
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5

      - name: Check SECURITY.md exists
        run: |
          if [ ! -f "SECURITY.md" ]; then
            echo "❌ Missing SECURITY.md"
            exit 1
          fi
          echo "✅ SECURITY.md present"

      - name: Verify SECURITY.md content
        run: |
          if ! grep -q "Reporting a Vulnerability" SECURITY.md; then
            echo "❌ SECURITY.md missing vulnerability reporting section"
            exit 1
          fi
          echo "✅ SECURITY.md has vulnerability reporting"

      - name: Check for hardcoded secrets
        run: |
          if grep -r "password\|secret\|api_key\|token" --include="*.rs" | grep -i "= \""; then
            echo "⚠️  Warning: Possible hardcoded credentials found"
          fi
          echo "✅ Secret check complete"
